---
phase: 02-base-payment-and-pricing
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/pricing/page.tsx
  - src/app/checkout/success/page.tsx
  - src/components/Header.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can view a dedicated pricing page that clearly explains what the song package includes"
    - "User can click a checkout button on the pricing page to start Stripe Checkout"
    - "After payment, user sees a success page confirming their order and explaining next steps"
    - "Pricing page is accessible from site navigation"
    - "Canceled checkout returns user to pricing page with feedback"
  artifacts:
    - path: "src/app/pricing/page.tsx"
      provides: "Pricing page with package details, value props, trust signals, and checkout CTA"
      min_lines: 80
    - path: "src/app/checkout/success/page.tsx"
      provides: "Post-payment success page with order confirmation and next steps"
      min_lines: 50
    - path: "src/components/Header.tsx"
      provides: "Updated header with Pricing nav link"
      contains: "/pricing"
  key_links:
    - from: "src/app/pricing/page.tsx"
      to: "src/actions/checkout.ts"
      via: "import and call createCheckout Server Action"
      pattern: "createCheckout"
    - from: "src/app/checkout/success/page.tsx"
      to: "Stripe API"
      via: "session_id from URL params used to retrieve session details"
      pattern: "session_id"
    - from: "src/components/Header.tsx"
      to: "src/app/pricing/page.tsx"
      via: "Link href=/pricing"
      pattern: "/pricing"
---

<objective>
Build the pricing page and checkout success page that complete the user-facing purchase flow. Users see a clear, compelling pricing page, click to purchase via Stripe Checkout, and land on a success page after payment.

Purpose: Without these pages, users have no way to understand what they're buying or confirm their purchase went through. The pricing page is the primary conversion point; the success page provides post-payment reassurance and directs users to their dashboard.

Output: Pricing page at /pricing, success page at /checkout/success, updated header navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-base-payment-and-pricing/02-RESEARCH.md

# Plan 01 creates the Server Action this plan calls
@.planning/phases/02-base-payment-and-pricing/02-01-PLAN.md

# Existing UI patterns and styling
@src/app/landing/page.tsx
@src/app/globals.css
@src/components/Header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build the pricing page with package details and checkout button</name>
  <files>
    src/app/pricing/page.tsx
  </files>
  <action>
Create `src/app/pricing/page.tsx` as a client component ('use client') with the following structure:

**Page layout** (match existing landing page aesthetic -- purple/pink gradient theme, rounded corners, shadow cards):

1. **Hero section** (top):
   - H1: "Create Your Perfect Song" (text-5xl font-bold, gradient text matching landing page style: from-pink-500 via-purple-500 to-indigo-500)
   - Subtitle: "Get 3 AI-generated song variants. Swipe to pick your favourite." (text-xl text-gray-600)

2. **Pricing card** (centered, max-w-md mx-auto):
   - Label: "Song Package" (text-sm font-semibold text-purple-600 uppercase)
   - Price: "£7.99" (text-6xl font-bold) with "one-time" suffix
   - Feature list with green checkmark SVGs (use same SVG pattern as research examples):
     - "3 unique song variants" with subtext "AI-generated variations to swipe between"
     - "Fully personalised lyrics" with subtext "Your memories and message woven throughout"
     - "High-quality audio download" with subtext "MP3 format, ready to share"
     - "Shareable gift link" with subtext "Send a unique URL to your recipient"
   - CTA button: "Create Your Song" (full width, bg-gradient-to-r from-purple-600 to-pink-600, rounded-xl, py-4, font-bold text-lg, hover effect)
   - Card border: border-2 border-purple-200, rounded-2xl, shadow-xl, bg-white, p-8

3. **Competitor comparison** (below card):
   - Small centered text: "Other personalised song services charge £45-£199+ and take days. SongSwipe delivers in minutes." (text-sm text-gray-500, max-w-lg mx-auto)

4. **Trust signals** (below comparison):
   - Row of 5 yellow star SVGs with "4.9/5" rating text
   - "Secure payment via Stripe" with lock emoji, "Generated in minutes" with sparkle emoji, "Satisfaction guaranteed"
   - Use bg-gray-50 rounded-lg p-6 container

5. **Canceled state**: If URL has `?canceled=true` query param, show a dismissable banner at the top: "Checkout was canceled. You can try again when you're ready." (yellow/amber background, similar to the success banner pattern in order/[id]/page.tsx)

**Checkout button behavior:**
- Import `createCheckout` from `@/actions/checkout`
- On click, set loading state (isLoading), clear errors, call `await createCheckout(customizationId)` in try-catch
- On success, redirect via `window.location.href = url!`
- On error, show error message below button (text-red-600)
- Disable button while loading, show "Processing..." text

**IMPORTANT:** The pricing page currently doesn't have a customizationId to pass to checkout. For now, the CTA button should link to `/customize` (the existing customization form which already handles checkout at the end). The pricing page's role in this phase is to communicate value and direct users into the customization flow. The checkout Server Action will be called from the customize form in a future update, or directly once the swipe builder (Phase 3) replaces the form.

So the CTA button should be a Next.js Link to `/customize` (not a Server Action call). Add a secondary "How it works" section link to the how-it-works section on the landing page if needed, or keep simple.

Actually, re-evaluating: the existing `/api/customize` route already creates a customization AND triggers checkout. The pricing page should send users to `/customize` to fill in their song details, and that page handles checkout. So:
- CTA button = `<Link href="/customize">` styled as the gradient button
- No Server Action call on this page (that happens after customization)

**Page wrapper:** min-h-screen bg-gradient-to-b from-purple-50 via-white to-pink-50 (match landing page background)

**Metadata export:** Export metadata object with title "Pricing" and description "Create a personalised AI song package - 3 unique variants for £7.99"
- Since the page needs 'use client' for useSearchParams (canceled query param), extract the metadata to a separate layout.tsx OR use a pattern where the pricing content is a client component imported by a server page. Choose the simpler option: make the page a server component that renders a client PricingContent component.

Revised approach:
- `src/app/pricing/page.tsx` is a SERVER component (no 'use client') that exports metadata and renders `<PricingContent />`
- The PricingContent component is defined inline or as a separate component. Since it only needs useSearchParams for the canceled banner, use Next.js `searchParams` prop on the server page instead (server components in App Router receive searchParams as prop).

Final approach: Make it a server component. Use `searchParams` prop to check for `canceled=true`. No client interactivity needed (CTA is a Link). This is simpler.

```tsx
import type { Metadata } from 'next'
import Link from 'next/link'

export const metadata: Metadata = {
  title: 'Pricing',
  description: 'Create a personalised AI song package - 3 unique variants for £7.99',
}

export default function PricingPage({
  searchParams,
}: {
  searchParams: { canceled?: string }
}) {
  const wasCanceled = searchParams.canceled === 'true'
  // ... render page
}
```
  </action>
  <verify>
Verify file exists: `ls src/app/pricing/page.tsx`. Check it contains metadata export, the price "7.99", feature list items, and a Link to "/customize". Verify it handles the canceled query parameter. Run `npx tsc --noEmit 2>&1 | head -30` for type checking.
  </verify>
  <done>
Pricing page exists at /pricing with clear package explanation (3 variants, personalised lyrics, audio download, shareable link), £7.99 price, competitor comparison callout, trust signals, and CTA linking to /customize. Canceled checkout shows feedback banner.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build checkout success page and update header navigation</name>
  <files>
    src/app/checkout/success/page.tsx
    src/components/Header.tsx
  </files>
  <action>
**src/app/checkout/success/page.tsx** -- Create as a client component ('use client'):

1. Use `useSearchParams()` to extract `session_id` from URL query params
2. If no session_id present, show "Invalid checkout session" error with Link back to /pricing
3. Display success confirmation:
   - Green checkmark icon or party emoji (match existing order page pattern)
   - H1: "Payment Successful!" (text-3xl font-bold)
   - Subtitle: "Your personalised song is being generated. This usually takes a few minutes."
   - Session reference: Show last 8 chars of session_id as reference number (e.g., "Reference: ...abc12345")
4. "What happens next" section (ordered list in a card):
   - "Our AI is generating 3 unique song variants based on your preferences"
   - "You'll be able to swipe through them and pick your favourite"
   - "Download your chosen song as a high-quality MP3"
5. Action buttons:
   - Primary: Link to `/dashboard` -- "Go to Dashboard" (btn-primary style)
   - Secondary: Link to `/` -- "Create Another Song" (text link, text-gray-600)
6. Use the same card styling as order page: white bg, rounded-2xl, shadow, p-8, max-w-2xl mx-auto
7. Page background: min-h-screen bg-gradient-to-b from-green-50 via-white to-purple-50 (green tint for success feel)

Export Metadata from a layout.tsx OR since this needs 'use client' for useSearchParams, wrap it:
- Create `src/app/checkout/success/page.tsx` as client component (no metadata export -- metadata can be added later via layout if needed, or use generateMetadata in a parent layout)

**src/components/Header.tsx** -- Update navigation:

1. Add "Pricing" link to the nav, between "Sign In" and "Create a Song" button
2. Use same styling as existing "Sign In" link: `className="px-4 py-2 text-gray-600 hover:text-gray-900 font-medium transition-colors"`
3. Link href="/pricing"
4. Keep existing "Sign In" and "Create a Song" links unchanged
5. Update the header visibility check: add `pathname?.startsWith('/pricing')` to the list of paths where header IS shown (it's currently hidden on dashboard/auth/customize/order -- pricing should show the header). Actually, the current logic HIDES header on those paths and shows it everywhere else. Since /pricing is not in the hide list, header already shows on /pricing. No change needed for visibility.
6. Also add `/checkout` to the paths where header is hidden (success page should be clean without nav): add `pathname?.startsWith('/checkout')` to the if-statement that returns null.

Final nav order: Pricing | Sign In | [Create a Song button]
  </action>
  <verify>
Verify files exist: `ls src/app/checkout/success/page.tsx src/components/Header.tsx`. Check success page contains 'session_id' and useSearchParams. Check Header contains '/pricing' link. Run `npx tsc --noEmit 2>&1 | head -30`.
  </verify>
  <done>
Checkout success page shows payment confirmation with session reference, next steps explanation, and navigation to dashboard. Header includes Pricing link in navigation. Header is hidden on /checkout paths for clean success experience.
  </done>
</task>

</tasks>

<verification>
1. `src/app/pricing/page.tsx` exists and renders pricing card with £7.99, feature list, CTA to /customize
2. `src/app/checkout/success/page.tsx` exists and handles session_id from URL params
3. `src/components/Header.tsx` includes Link to /pricing in navigation
4. Pricing page handles ?canceled=true query param with user feedback
5. Success page shows next steps (3 variants being generated, swipe to pick, download)
6. TypeScript compiles: `npx tsc --noEmit`
7. All pages follow existing visual style (purple/pink gradients, rounded cards, shadow-sm/xl)
</verification>

<success_criteria>
- User can navigate to /pricing from site header
- Pricing page clearly communicates: 3 variants, personalised lyrics, audio download, £7.99 one-time
- CTA directs user to /customize to start the song creation flow
- After successful Stripe payment, user lands on /checkout/success with confirmation
- Success page explains what happens next and links to dashboard
- Canceled checkout shows feedback on pricing page
</success_criteria>

<output>
After completion, create `.planning/phases/02-base-payment-and-pricing/02-02-SUMMARY.md`
</output>
